<!DOCTYPE html><html lang="en"><head><title>modules/presentation</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="modules/presentation"><meta name="groc-project-path" content="js/modules/presentation.js"><meta name="groc-github-url" content="https://github.com/kkemple/talks.browserify-marionette"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/kkemple/talks.browserify-marionette/blob/master/js/modules/presentation.js">js/modules/presentation.js</a></div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> Marionette = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../libs/marionette'</span>),
    Backbone = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../libs/backbone'</span>),
    $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../libs/jquery'</span>),
    PresentationRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../routes/presentation'</span>),
    PresentationController = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../controllers/presentation'</span>),
    Slides = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../collections/slides'</span>),
    slidesConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../config/slides'</span>),
    PresentationView = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../views/presentation'</span>),
    vent = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../config/events'</span>),
    commands = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../config/commands'</span>),
    PresentationModule;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The main (only) module for this application,
modules are responsible for building up / breaking down
the functionality / data needed for this module to run properly</p>
<p>Each module has its own router and controller and it is responsible
for providing each piece of functionality with the proper options/data</p>
<p>This will also make it easy to break down code that is no longer needed
when the module is not needed</p></div></div><div class="code"><div class="wrapper">PresentationModule = Marionette.Module.extend({</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>make sure the module does not start on app initialization</p></div></div><div class="code"><div class="wrapper">    startWithParent: <span class="hljs-literal">false</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>flag to tell if module is started</p></div></div><div class="code"><div class="wrapper">    _started: <span class="hljs-literal">false</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Gather all the collection/routers/controllers for the module,
listen for any route changes</p></div></div><div class="code"><div class="wrapper">    initialize: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">this</span>.slides = <span class="hljs-keyword">new</span> Slides(slidesConfig);
        <span class="hljs-keyword">this</span>.controller = <span class="hljs-keyword">new</span> PresentationController({ slides: <span class="hljs-keyword">this</span>.slides });
        <span class="hljs-keyword">this</span>.router = <span class="hljs-keyword">new</span> PresentationRouter({ controller: <span class="hljs-keyword">this</span>.controller });
        <span class="hljs-keyword">this</span>.listenTo(Backbone.history, <span class="hljs-string">'route'</span>, <span class="hljs-keyword">this</span>._onRoute);
    },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Set our flag so we know we the module is started,
If we have any view handling, handle it here</p>
<p>Set up all listeners, trigger any events we need to fire</p></div></div><div class="code"><div class="wrapper">    onStart: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">this</span>._started = !<span class="hljs-keyword">this</span>._started;
        <span class="hljs-keyword">this</span>.view = <span class="hljs-keyword">new</span> PresentationView({ collection: <span class="hljs-keyword">this</span>.slides });
        commands.setHandler(<span class="hljs-string">'presentation:step'</span>, <span class="hljs-keyword">this</span>._onStepEvent.bind(<span class="hljs-keyword">this</span>));
        vent.trigger(<span class="hljs-string">'app:screen'</span>, <span class="hljs-keyword">this</span>.view);

        $(document).on(<span class="hljs-string">'keyup'</span>, <span class="hljs-keyword">this</span>._onKeyboardEvent.bind(<span class="hljs-keyword">this</span>));
    },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Set our flag so we know we the module is stopped,
If we have any views active, destroy them</p>
<p>Remove any event listeners, trigger any events we need to fire</p></div></div><div class="code"><div class="wrapper">    onStop: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">this</span>._started = !<span class="hljs-keyword">this</span>._started;
        <span class="hljs-keyword">this</span>.view.destroy();
        commands.removeHandler(<span class="hljs-string">'presentation:step'</span>);

        $(document).off(<span class="hljs-string">'keyup'</span>, <span class="hljs-keyword">this</span>._onKeyboardEvent.bind(<span class="hljs-keyword">this</span>));
    },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Our module is concerned with the &#39;presentation:step&#39; event
this is our handler for that event</p></div></div><div class="code"><div class="wrapper">    _onStepEvent: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(action)</span> {</span>
        <span class="hljs-keyword">this</span>.slides[action]();
    },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The handler for any backbone route change,
we want to know if our router is concerned with the route,
if we are, start the module, if we are not, stop the module</p></div></div><div class="code"><div class="wrapper">    _onRoute: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(router)</span> {</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.router === router) {
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._started) <span class="hljs-keyword">this</span>.start();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._started) <span class="hljs-keyword">this</span>.stop();
        }
    },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The handler for any keyup events,
we want to know if the user is trying to
navigate through the presentation</p></div></div><div class="code"><div class="wrapper">    _onKeyboardEvent: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
        <span class="hljs-keyword">switch</span> (e.which) {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>For left and up, step backward</p></div></div><div class="code"><div class="wrapper">            <span class="hljs-keyword">case</span> <span class="hljs-number">37</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-number">38</span>:
                <span class="hljs-keyword">this</span>.slides.stepBackward();
                e.preventDefault();
                <span class="hljs-keyword">break</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>For right and down, step forward</p></div></div><div class="code"><div class="wrapper">            <span class="hljs-keyword">case</span> <span class="hljs-number">39</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-number">40</span>:
                <span class="hljs-keyword">this</span>.slides.stepForward();
                e.preventDefault();
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">break</span>;
        }
    }
});

module.exports = PresentationModule;</div></div></div></div></body></html>