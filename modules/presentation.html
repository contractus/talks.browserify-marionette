<!DOCTYPE html><html lang="en"><head><title>modules/presentation</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="modules/presentation"><meta name="groc-project-path" content="js/modules/presentation.js"><meta name="groc-github-url" content="https://github.com/kkemple/talks.browserify-marionette"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/kkemple/talks.browserify-marionette/blob/master/js/modules/presentation.js">js/modules/presentation.js</a></div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> Marionette = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../libs/marionette'</span>),
    Backbone = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../libs/backbone'</span>),
    PresentationRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../routes/presentation'</span>),
    PresentationController = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../controllers/presentation'</span>),
    Slides = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../collections/slides'</span>),
    slidesConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../config/slides'</span>),
    commands = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../config/commands'</span>),
    PresentationModule;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The main (only) module for this application,
modules are responsible for building up / breaking down
the functionality / data needed for this module to run properly</p>
<p>Each module has its own router and controller and it is responsible
for providing each piece of functionality with the proper options/data</p>
<p>This will also make it easy to break down code that is no longer needed
when the module is not needed</p></div></div><div class="code"><div class="wrapper">PresentationModule = Marionette.Module.extend({</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>make sure the module does not start on app initialization</p></div></div><div class="code"><div class="wrapper">    startWithParent: <span class="hljs-literal">false</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>flag to tell if module is started</p></div></div><div class="code"><div class="wrapper">    _started: <span class="hljs-literal">false</span>,</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Gather all the collection/routers/controllers for the module,
listen for any route changes</p></div></div><div class="code"><div class="wrapper">    initialize: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">this</span>.slides = <span class="hljs-keyword">new</span> Slides(slidesConfig);
        <span class="hljs-keyword">this</span>.controller = <span class="hljs-keyword">new</span> PresentationController({ slides: <span class="hljs-keyword">this</span>.slides });
        <span class="hljs-keyword">this</span>.router = <span class="hljs-keyword">new</span> PresentationRouter({ controller: <span class="hljs-keyword">this</span>.controller });
        <span class="hljs-keyword">this</span>.listenTo(Backbone.history, <span class="hljs-string">'route'</span>, <span class="hljs-keyword">this</span>._onRoute);
    },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Set our flag so we know we the module is started,
set up all listeners/handlers</p></div></div><div class="code"><div class="wrapper">    onStart: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">this</span>._started = !<span class="hljs-keyword">this</span>._started;
        commands.setHandler(<span class="hljs-string">'presentation:step'</span>, <span class="hljs-keyword">this</span>._onStep.bind(<span class="hljs-keyword">this</span>));
    },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Set our flag so we know we the module is stopped,
remove any event listeners/handlers</p></div></div><div class="code"><div class="wrapper">    onStop: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">this</span>._started = !<span class="hljs-keyword">this</span>._started;
        commands.removeHandler(<span class="hljs-string">'presentation:step'</span>);
    },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Our module is concerned with the &#39;presentation:step&#39; event
this is our handler for that event</p></div></div><div class="code"><div class="wrapper">    _onStep: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(action)</span> {</span>
        <span class="hljs-keyword">if</span> (action !== <span class="hljs-string">'stepBackward'</span> &amp;&amp;
                action !== <span class="hljs-string">'stepForward'</span>) {

            <span class="hljs-keyword">var</span> errorMessage = <span class="hljs-string">''</span> +
                    <span class="hljs-string">'command: presentation:step '</span> +
                    <span class="hljs-string">':: parameter must be either'</span> +
                    <span class="hljs-string">' \'stepBackward\' or \'stepForward\''</span>;

            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(errorMessage);
        }

        <span class="hljs-keyword">this</span>.slides[action]();
    },</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The handler for any backbone route change,
we want to know if our router is concerned with the route,
if we are, start the module, if we are not, stop the module</p></div></div><div class="code"><div class="wrapper">    _onRoute: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(router)</span> {</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.router === router) {
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._started) <span class="hljs-keyword">this</span>.start();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._started) <span class="hljs-keyword">this</span>.stop();
        }
    }
});

module.exports = PresentationModule;</div></div></div></div></body></html>